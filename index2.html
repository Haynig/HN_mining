<!DOCTYPE html>
<html>
<head>
  <title>HN Wallet</title>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <style>
    body { font-family: Arial; background:#f4f6f9; text-align:center; }
    .hidden { display:none; }
    .card {
      background:white;
      width:350px;
      margin:20px auto;
      padding:20px;
      border-radius:12px;
      box-shadow:0 5px 15px rgba(0,0,0,0.1);
    }
    input { width:100%; padding:8px; margin:6px 0; }
    button { padding:8px 15px; margin:5px; cursor:pointer; }
    .balance { font-size:20px; margin:10px 0; }
    .title { font-size:22px; font-weight:bold; }
  </style>
</head>
<body>

<h1>HN Wallet</h1>

<!-- HOME -->
<div id="home">
  <button onclick="showRegister()">Register</button>
  <button onclick="showLogin()">Login</button>
</div>

<!-- REGISTER -->
<div id="registerBox" class="card hidden">
  <div class="title">Register</div>
  <input id="rname" placeholder="Name">
  <input id="remail" placeholder="Email">
  <input id="rpassword" type="password" placeholder="Password">
  <button onclick="register()">Register</button>
  <button onclick="goHome()">Back</button>
</div>

<!-- LOGIN -->
<div id="loginBox" class="card hidden">
  <div class="title">Login</div>
  <input id="lemail" placeholder="Email">
  <input id="lpassword" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <button onclick="goHome()">Back</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

  <div class="card">
    <div class="title">Main Balance</div>
    <div class="balance">HN: <span id="hnBalance">0</span></div>
    <div class="balance">So'm: <span id="somBalance">0</span></div>
    <div>Kurs: 1 HN = 1200 so'm</div>
  </div>

  <div class="card">
    <div class="title">Jamg'arma</div>
    <div class="balance"><span id="savingsBalance">0</span> HN</div>
    <button onclick="moveToSavings()">Jamg'armaga o'tkazish</button>
  </div>

  <div class="card">
    <div class="title">Bonus</div>
    <div class="balance"><span id="bonusBalance">0</span> HN</div>
    <button onclick="bonusToMain()">100 HN ni asosiy balansga o'tkazish</button>
  </div>

  <div class="card">
    <div class="title">Amaliyotlar</div>
    <input id="amount" placeholder="Amount">
    <button onclick="deposit()">Deposit</button>
    <button onclick="withdraw()">Withdraw</button>
    <button onclick="convert()">HN â†” So'm</button>
    <button onclick="loadBalance()">Yangilash</button>
    <button onclick="logout()">Logout</button>
  </div>
  
  <div id="ton-connect"></div>
  
</div>

<script>
const API = "https://hn-bilimdoni-backend.onrender.com";
const RATE = 1200;
let token = localStorage.getItem("token") || "";

if (token) showDashboard();

  manifestUrl: "https://haynig.github.io/HN_mining/tonconnect-manifest.json"
  
// UI
function showRegister(){ home.style.display="none"; registerBox.style.display="block"; }
function showLogin(){ home.style.display="none"; loginBox.style.display="block"; }
function goHome(){ registerBox.style.display="none"; loginBox.style.display="none"; home.style.display="block"; }
function showDashboard(){ home.style.display="none"; loginBox.style.display="none"; registerBox.style.display="none"; dashboard.style.display="block"; loadBalance(); }
function logout(){ localStorage.removeItem("token"); token=""; dashboard.style.display="none"; home.style.display="block"; }

// REGISTER
async function register(){
  const res = await fetch(`${API}/api/user/register`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name:rname.value,email:remail.value,password:rpassword.value})
  });
  const data=await res.json();
  alert(data.message||"Registered");
  goHome();
}

// LOGIN
async function login(){
  const res = await fetch(`${API}/api/user/login`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({email:lemail.value,password:lpassword.value})
  });
  const data=await res.json();
  if(res.ok){
    token=data.token;
    localStorage.setItem("token",token);
    showDashboard();
  }else{
    alert(data.message||"Login error");
  }
}

// LOAD BALANCE
async function loadBalance(){
  const res = await fetch(`${API}/api/wallet/balance`,{
    headers:{Authorization:"Bearer "+token}
  });
  const data=await res.json();
  hnBalance.innerText=data.balance||0;
  somBalance.innerText=(data.balance*RATE)||0;
  savingsBalance.innerText=data.savings||0;
  bonusBalance.innerText=data.bonus||0;
}

// DEPOSIT
async function deposit(){
  await fetch(`${API}/api/wallet/deposit`,{
    method:"POST",
    headers:{ "Content-Type":"application/json", Authorization:"Bearer "+token },
    body:JSON.stringify({amount:Number(amount.value)})
  });
  loadBalance();
}

// WITHDRAW
async function withdraw(){
  await fetch(`${API}/api/wallet/withdraw`,{
    method:"POST",
    headers:{ "Content-Type":"application/json", Authorization:"Bearer "+token },
    body:JSON.stringify({amount:Number(amount.value)})
  });
  loadBalance();
}

// CONVERT
async function convert(){
  await fetch(`${API}/api/wallet/convert`,{
    method:"POST",
    headers:{ "Content-Type":"application/json", Authorization:"Bearer "+token },
    body:JSON.stringify({amount:Number(amount.value)})
  });
  loadBalance();
}

// SAVINGS
async function moveToSavings(){
  await fetch(`${API}/api/wallet/savings`,{
    method:"POST",
    headers:{ "Content-Type":"application/json", Authorization:"Bearer "+token },
    body:JSON.stringify({amount:10})
  });
  loadBalance();
}

// BONUS
async function bonusToMain(){
  await fetch(`${API}/api/wallet/bonus-transfer`,{
    method:"POST",
    headers:{ Authorization:"Bearer "+token }
  });
  loadBalance();
}
</script>

</body>
</html>




