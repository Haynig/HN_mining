<!DOCTYPE html>
<html>
<head>
  <title>HN Wallet</title>
</head>
<body>
<h1>HN Wallet</h1>

<h3>Register</h3>
<input id="rname" placeholder="Name">
<input id="remail" placeholder="Email">
<input id="rpassword" type="password" placeholder="Password">
<button onclick="register()">Register</button>

<h3>Login</h3>
<input id="lemail" placeholder="Email">
<input id="lpassword" type="password" placeholder="Password">
<button onclick="login()">Login</button>

<h3>Wallet</h3>
<input id="amount" placeholder="Amount">
<button onclick="deposit()">Deposit</button>
<button onclick="withdraw()">Withdraw</button>
<button onclick="balance()">Balance</button>

<p id="result"></p>

<script>
let token = "";

async function register() {
  await fetch("/api/user/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      name: rname.value,
      email: remail.value,
      password: rpassword.value
    })
  });
  alert("Registered");
}

async function login() {
  const res = await fetch("/api/user/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      email: lemail.value,
      password: lpassword.value
    })
  });
  const data = await res.json();
  token = data.token;
  alert("Login success");
}

async function deposit() {
  await fetch("/api/wallet/deposit", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify({ amount: amount.value })
  });
  alert("Deposited");
}

async function withdraw() {
  await fetch("/api/wallet/withdraw", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify({ amount: amount.value })
  });
  alert("Withdrawn");
}

async function balance() {
  const res = await fetch("/api/wallet/balance", {
    headers: { "Authorization": "Bearer " + token }
  });
  const data = await res.json();
  result.innerText = "Balance: " + data.balance;
}
</script>

</body>
</html>
