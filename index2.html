<!DOCTYPE html>
<html>
<head>
  <title>HN Wallet</title>
</head>
<body>
<h1>HN Wallet</h1>

<h3>Register</h3>
<input id="rname" placeholder="Name">
<input id="remail" placeholder="Email">
<input id="rpassword" type="password" placeholder="Password">
<button onclick="register()">Register</button>

<h3>Login</h3>
<input id="lemail" placeholder="Email">
<input id="lpassword" type="password" placeholder="Password">
<button onclick="login()">Login</button>

<h3>Wallet</h3>
<input id="amount" placeholder="Amount">
<button onclick="deposit()">Deposit</button>
<button onclick="withdraw()">Withdraw</button>
<button onclick="balance()">Balance</button>

<p id="result"></p>

<script>
const API = "https://hn-bilimdoni-backend.onrender.com";

let token = "";

// REGISTER
async function register() {
  try {
    const res = await fetch(`${API}/api/user/register`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name: rname.value,
        email: remail.value,
        password: rpassword.value
      })
    });

    const data = await res.json();

    if (res.ok) {
      alert("Registered ✅");
    } else {
      alert(data.message || "Xatolik");
    }

  } catch (err) {
    alert("Server bilan bog'lanib bo'lmadi");
  }
}

// LOGIN
async function login() {
  try {
    const res = await fetch(`${API}/api/user/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        email: lemail.value,
        password: lpassword.value
      })
    });

    const data = await res.json();

    if (res.ok) {
      token = data.token;
      alert("Login success ✅");
    } else {
      alert(data.message || "Login xato");
    }

  } catch (err) {
    alert("Server bilan bog'lanib bo'lmadi");
  }
}

// DEPOSIT
async function deposit() {
  if (!token) return alert("Avval login qiling");

  await fetch(`${API}/api/wallet/deposit`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify({ amount: Number(amount.value) })
  });

  alert("Deposited");
}

// WITHDRAW
async function withdraw() {
  if (!token) return alert("Avval login qiling");

  await fetch(`${API}/api/wallet/withdraw`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer " + token
    },
    body: JSON.stringify({ amount: Number(amount.value) })
  });

  alert("Withdrawn");
}

// BALANCE
async function balance() {
  if (!token) return alert("Avval login qiling");

  const res = await fetch(`${API}/api/wallet/balance`, {
    headers: { "Authorization": "Bearer " + token }
  });

  const data = await res.json();
  result.innerText = "Balance: " + data.balance;
}
</script>

</body>
</html>
