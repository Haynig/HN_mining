<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HN Bilimdoni</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
<script src="https://unpkg.com/@ton/core@latest/dist/index.umd.js"></script>
</head>

<body>
<h2>HN Bilimdoni</h2>

<button onclick="connect()">ðŸ”— Wallet ulash</button>
<button onclick="burn()" id="burnBtn" disabled>ðŸ”¥ 1 jetton ishlatish</button>

<pre id="log"></pre>

<script>
const tg = window.Telegram.WebApp;
const tg_id = tg.initDataUnsafe.user.id;
const { beginCell, toNano } = tonCore;

const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
  manifestUrl: 'https://raw.githubusercontent.com/Haynig/HN_mining/main/tonconnect-manifest1.json'
});

function log(t){ document.getElementById('log').textContent += t + '\\n'; }

async function connect(){
  await tonConnectUI.openModal();
  if (tonConnectUI.wallet) {
    log('Wallet ulandi');
    document.getElementById('burnBtn').disabled = false;
  }
}

function burnPayload(){
  return beginCell()
    .storeUint(0x595f07bc, 32)
    .storeUint(0, 64)
    .storeCoins(1n)
    .storeAddress(null)
    .endCell().toBoc().toString('base64');
}

async function burn(){
  const wallet = tonConnectUI.wallet.account.address;
  const tx = {
    validUntil: Math.floor(Date.now()/1000)+300,
    messages: [{
      address: wallet,
      amount: toNano('0.05').toString(),
      payload: burnPayload()
    }]
  };
  const res = await tonConnectUI.sendTransaction(tx);
  log('Jetton ishlatildi');
  await fetch('http://localhost:3000/verify', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ tg_id, tx: res.boc })
  });
}
</script>
</body>
</html>



